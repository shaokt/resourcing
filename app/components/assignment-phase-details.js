import Ember from 'ember';

export default Ember.Component.extend({
    tagName:"",

    // before pasting into the div, make sure no styles generated by chrome get included
    sanitize: function(tag){
        $('*', $(tag)).each(function () {
            Ember.$(this).removeAttr('style');
            if(this.className==="Apple-converted-space" || this.tagName.match(/meta/gi)){
                $(this).remove();
            }
        });
        return tag;
    },

    /* checks if the contenteditable area is empty
     * if it is, ensure to stick in an empty div to get the proper styles for bullets
     */
    checkEmpty: function(){
        if(!event.target.childNodes.length ||           // empty
            event.target.innerHTML.trim() === '' ||     // blank textnode
            event.target.innerHTML === "<br>" ||        // br inserted by chrome
            event.target.innerHTML === "<div></div>"    // div inserted by code to create bullet style
        ){
            event.target.innerHTML = "";
            $(event.target).innerHTML="";
            $(event.target).append("<div><br></div>");
            return false;
        }
        return true;
    },

    actions: {
        keyup(){
            // if deleting, make sure the editable area is not empty: if it is, reinsert blank div
            if(event.keyCode === 46 || event.keyCode === 8){
                return this.checkEmpty(event);
            }
            else { // let whatever characters go through
                return true;
            }
        },

        checkEmpty() {
            return this.checkEmpty(event);
        },

        paste(){
            let pasteTarget = $(event.target)[0].innerHTML;
             if (event.clipboardData && event.clipboardData.getData) {
                let paste = event.clipboardData.getData('text/html');
                var temp = Ember.$('<div></div>').append(paste)
                temp = this.sanitize(temp);
             }

             // if pasting into an open div with no content, remove div so you don't end up nesting the pasted content into that bullet
             if(pasteTarget === ''){
                $(event.target).parent().remove();
             }

            document.execCommand("insertHTML", false, temp[0].innerHTML); // pasted the copied content
            document.execCommand("insertHTML", '<br>'); // add new line to force chrome to not merge existing bullets after pasting
            return false;
        }
    }
});
